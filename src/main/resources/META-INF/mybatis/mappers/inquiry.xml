<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.helf.mapper.InquiryMapper">
	
	<!-- 문의 글쓰기 -->
	<insert id="insertInquiry" parameterType="Inquiry">
		insert into helf_inquiries
		(inquiry_no, inquiry_type, inquiry_title, inquiry_secret, user_id, inquiry_content)
		values
		(helf_inquiry_seq.nextval, #{type}, #{title}, #{secret}, #{user.id}, #{content})
	</insert>
	
	<!-- 모든 행 조회 (페이징처리) -->
    <select id="getTotalRows" parameterType="map" resultType="int">
        select count(*)
        from  helf_inquiries
    </select>
  
  	<!-- 모든 문의 조회(페이징처리 포함) -->
    <select id="getAllInquiry" resultType="Inquiry" parameterType="map">
        select *
        from(select
                i.inquiry_no						as no,				
                i.inquiry_type						as type,
                i.inquiry_title						as title,
                i.inquiry_create_date				as createDate,
                i.inquiry_update_date				as updateDate,
                i.inquiry_is_answer					as isAnswer,
                i.inquiry_answer					as answer,
                i.user_id							as "user.id",
                i.inquiry_secret					as secret,
                i.file_name							as filename,
                u.user_name							as "user.name",
                i.inquiry_content					as content,
                row_number() over (order by inquiry_no asc) rownumber
             from
                helf_inquiries i
             LEFT JOIN helf_users u ON i.user_id = u.user_id
            )
        where
            rownumber between #{begin} and #{end}
    </select>
  
  	<!-- 문의 상세정보 조회  -->
  	<select id="getinquiryByNo" resultType="Inquiry" parameterType="int">
    	select 
    		i.inquiry_no							as no,				
            i.inquiry_type							as type,
            i.inquiry_title							as title,
            i.inquiry_create_date					as createDate,
            i.inquiry_update_date					as updateDate,
            i.inquiry_is_answer						as isAnswer,
            i.inquiry_answer						as answer,
            u.user_id								as "user.id",
            i.inquiry_secret						as secret,
            i.file_name								as filename,
            u.user_name								as "user.name",
            i.inquiry_content						as content
    	from
    		helf_inquiries i, helf_users u
    	where
    		i.user_id = u.user_id
    		and inquiry_no = #{no}
    </select>
    
</mapper>
