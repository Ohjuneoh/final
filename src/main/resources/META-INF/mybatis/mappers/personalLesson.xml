<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.helf.mapper.PersonalLessonMapper">

	<select id="getCareerByTrainerNo" parameterType="int" resultType="Career">
		select
			career_no,
			career_name,
			career_start_date,
			career_end_date,
			trainer_no
		from helf_trainer_career
		where
			trainer_no = #{value}
		order by
			career_start_date;
	</select>
	<!-- User 테이블에서 트레이너 번호로 전체 트레이너 찾기  -->
	<select id="getUserByTrainerNo" parameterType="int" resultType="User">
				select
			user_id					as id,
			user_email				as email,
			user_name				as name,
			user_tel				as tel,
			user_encrypted_password as encryptedPassword,
			user_gender				as gender,
			user_status				as status,
			user_mobile_carrier		as mobileCarrier,
			user_create_date		as createDate,
			user_update_date		as updateDate,
			user_point				as point,
			rank_no					as "rank.no",
			user_type				as type
			
		from
			helf_users
		where 
			trainer_no = #{value}
	</select>
	<resultMap type="kr.co.helf.vo.Trainer" id="getAllTrainersWithCareer" >
    	<id column="trainer_no" property="trainerNo"/>
    	<result column="trainer_file" property="trainerFile"/>
    	<association property="user" javaType="kr.co.helf.vo.User">
    		<id column="user_id" property="id"/>
    		<result column="name" property="name"/>
    	</association>
    	<collection property="careers" ofType="Career">
        	<id column="career_no" property="careerNo"/>
        	<result column="career_name" property="careerName"/>
        	<result column="career_start_date" property="careerStartDate"/>
        	<result column="career_end_date" property="careerEndDate"/>
    	</collection>
	</resultMap>
	<select id="getAllTrainersWithCareer" resultMap="getAllTrainersWithCareer">
		select
			b.trainer_no,
			a.user_name	as name,
			b.trainer_file,
			c.career_no,
			c.career_name,
			c.career_start_date,
			c.career_end_date
		from
		    helf_users a, helf_trainers b, helf_trainer_career c
		where
			a.user_id = b.user_id
			and c.trainer_no = b.trainer_no
		order by
			trainer_no
	</select>
	<insert id="insertConsultation" parameterType="Consultation">
		insert into helf_lesson_consultation(lesson_consultation_no, 
											 lesson_consultation_exercise_goal,
											 lesson_consultation_physical_abnormalities,
											 lesson_consultation_request_date,
											 lesson_consultation_request_time,
											 user_id,
											 trainer_no,
											 my_membership_no)
		values(helf_lesson_consultation_seq.nextval, #{goal}, #{abnormalities}, #{applicationDate}, #{requestTime}, #{user.id}, #{trainer.trainerNo}, #{myMembership.no})
	</insert>
	<resultMap id="UserMyMembershipsMap" type="kr.co.helf.dto.UserMyMemberships">
	    <!-- Membership 객체 매핑 -->
	    <association property="membership" javaType="kr.co.helf.vo.Membership">
	        <result column="membership_no" property="no"/>
	        <result column="membership_name" property="name"/>
	    </association>
	
	    <!-- MyMembership 객체 리스트 매핑 -->
	    <collection property="myMembership" ofType="kr.co.helf.vo.MyMembership">
	        <result column="my_membership_startdate" property="startDate"/>
	        <result column="my_membership_no" property="no"/>
	        <result column="my_membership_enddate" property="endDate"/>
	        <result column="my_membership_remainder_cnt" property="remainderCnt"/>
	        <result column="my_membership_state" property="state"/>
	    </collection>
	</resultMap>
	<select id="getUserMyMembershipById" parameterType="string"  resultMap="UserMyMembershipsMap">
		select b.membership_no,
				b.my_membership_no,
		        a.membership_name,
		        b.my_membership_startdate,
		        b.my_membership_enddate,
		        b.my_membership_remainder_cnt,
	       		b.my_membership_state
		from 	helf_membership a, helf_my_membership b
		where 	a.membership_no = b.membership_no
		and 	b.user_id=#{userId}
		ORDER BY b.my_membership_no asc
	</select>
	<!-- <resultMap type="kr.co.helf.vo.User" id="getAllUserWithConsultation" >
    	<id column="user_id" property="id"/>
    	<result column="user_name" property="name"/>
    	<association property="rank" javaType="kr.co.helf.vo.Rank">
    		<id column="rank_no" property="no"/>
    		<result column="rank_name" property="name"/>
    	</association>
    	<collection property="consultation" ofType="kr.co.helf.vo.Consultation">
        	<id column="lesson_consultation_no" property="consultationNo"/>
        	<result column="lesson_consultation_status" property="consultationStatus"/>
        	<result column="lesson_consultation_application_date" property="applicationDate"/>
        	<result column="lesson_consultation_request_date" property="requestDate"/>
        	<result column="lesson_consultation_request_time" property="requestTime"/>
    	</collection>
	</resultMap>
	<select id="getAllUserWithConsultation" resultMap="getAllUserWithConsultation">
		select
			a.user_name,
			a.user_rank,
			b.lesson_consultation_no,
			b.lesson_consultation_status,
			b.lesson_consultation_application_date,
			b.lesson_consultation_request_time,
			b.lesson_consultation_request_date,
			b.trainer_no,
			b.user_id,
			b.my_membership_no
		from
		    helf_users a, helf_lesson_consultation b
		where
			a.user_id = b.user_id
		order by
			b.lesson_consultation_no
	</select>  -->
	
</mapper>
